--  ★ 테이블과 시퀀스 중복 유뮤 확인
DROP TABLE STUDENT;
DROP TABLE MAJOR;
DROP SEQUENCE STUDENT_NO_SEQ;

--  ★ 테이블과 시퀀스 생성
CREATE TABLE STUDENT (
    sNO NUMBER(9) PRIMARY KEY,
    sNAME VARCHAR2(50) NOT NULL,
    mNO NUMBER(2) REFERENCES MAJOR(mNO),
    SCORE NUMBER(3) CHECK(SCORE >=0 AND SCORE <= 100),
    sEXPEL NUMBER(1) DEFAULT 0, CHECK(sEXPEL = 0 OR sEXPEL = 1)
);

CREATE TABLE MAJOR (
    mNO NUMBER(2) PRIMARY KEY,
    mNAME VARCHAR2(50) NOT NULL
);

CREATE SEQUENCE STUDENT_NO_SEQ
    MAXVALUE 9999999
    NOCACHE
    NOCYCLE;
    
--  ★ 학생 입력
SELECT *
    FROM STUDENT;
    
SELECT *
    FROM MAJOR;
    
SELECT EXTRACT(YEAR FROM SYSDATE) || TRIM(TO_CHAR(STUDENT_NO_SEQ.CURRVAL, '000'))
    FROM DUAL;
    
INSERT INTO MAJOR
    VALUES (10, '경제');
    
INSERT INTO MAJOR
    VALUES (20, '영어');
    
INSERT INTO MAJOR
    VALUES (30, '무역');
    
INSERT INTO STUDENT (SNO, SNAME, MNO, SCORE)
    VALUES (EXTRACT(YEAR FROM SYSDATE) || TRIM(TO_CHAR(STUDENT_NO_SEQ.NEXTVAL, '000')),
    '유비', (SELECT MNO FROM MAJOR WHERE MNAME = '경제'), 95);
    
INSERT INTO STUDENT (SNO, SNAME, MNO, SCORE)
    VALUES (EXTRACT(YEAR FROM SYSDATE) || TRIM(TO_CHAR(STUDENT_NO_SEQ.NEXTVAL, '000')), '관우', 20, 85);
    
INSERT INTO STUDENT (SNO, SNAME, MNO, SCORE)
    VALUES (EXTRACT(YEAR FROM SYSDATE) || TRIM(TO_CHAR(STUDENT_NO_SEQ.NEXTVAL, '000')), '장비', 30, 90);
    
INSERT INTO STUDENT (SNO, SNAME, MNO, SCORE)
    VALUES (EXTRACT(YEAR FROM SYSDATE) || TRIM(TO_CHAR(STUDENT_NO_SEQ.NEXTVAL, '000')), '손책', 30, 90);
    
delete from student
    where sname = '홍길동';

COMMIT;

--  ★ 학번으로 검색, 이름으로 검색, 전공으로 검색
SELECT SNO, SNAME, MNAME, SCORE
    FROM STUDENT S, MAJOR M
    WHERE S.MNO = M.MNO AND SNO = 2021001;
    
SELECT SNO, SNAME, MNAME, SCORE
    FROM STUDENT S, MAJOR M
    WHERE S.MNO = M.MNO AND SNAME = '관우';
    
SELECT SNO, SNAME, MNAME, SCORE
    FROM STUDENT S, MAJOR M
    WHERE S.MNO = M.MNO AND MNAME = '경제';
    
--  ★ 학생 수정
UPDATE STUDENT
    SET SNAME = '손책', MNO = (SELECT MNO FROM MAJOR WHERE MNAME = '경제'),
        SCORE = 80
    WHERE SNO = '2021006';
    
--  ★ 출력 ( 등수, 이름(학번), 전공명(전공코드), 점수)
SELECT ROWNUM RANK, SNAME || '('||SNO||')' SNAME, mNAME||'('||mNO||')' mNAME, SCORE
    FROM (SELECT S.*, MNAME FROM STUDENT S, MAJOR M
                WHERE S.MNO=M.MNO AND SEXPEL = 0
                ORDER BY SCORE DESC);

--  ★ 제적자 처리, 제적자 출력
UPDATE STUDENT
    SET SEXPEL = 1
    WHERE SNO = '2021004';

SELECT ROWNUM RANK, SNAME || '(' || SNO || ')' SNAME, MNAME || '(' || MNO || ')' MNAME, SCORE
    FROM (SELECT S.*, MNAME FROM STUDENT S, MAJOR M
    WHERE S.MNO=M.MNO AND SEXPEL=1
    ORDER BY SCORE DESC);

COMMIT;

SELECT *
    FROM STUDENT;

--  ★ 전공검색
SELECT MNAME
    FROM MAJOR;
    
    
    
    
    
    
    
    
    